{"version":3,"file":"ModelLoader.js","sources":["../src/ModelLoader.js"],"sourcesContent":["/**\r\n * @author Garrett Johnson / http://gkjohnson.github.io/\r\n * https://github.com/gkjohnson/threejs-model-loader\r\n */\r\nimport { DefaultLoadingManager, MeshPhongMaterial, Mesh } from 'three';\r\n\r\nconst loaderMap = {\r\n\r\n\t'3mf': '3MFLoader',\r\n\t'amf': 'AMFLoader',\r\n\t'bvh': 'BVHLoader',\r\n\t'assimp': 'AssimpLoader',\r\n\t'babylon': 'BabylonLoader',\r\n\t'dae': 'ColladaLoader',\r\n\t'drc': 'DRACOLoader',\r\n\t'fbx': 'FBXLoader',\r\n\t'gcode': 'GCodeLoader',\r\n\t'gltf': 'GLTFLoader',\r\n\t'glb': 'GLTFLoader',\r\n\t'kmz': 'KMZLoader',\r\n\t'md2': 'MD2Loader',\r\n\t'mmd': 'MMDLoader',\r\n\t'obj': 'OBJLoader',\r\n\t'ply': 'PLYLoader',\r\n\t'pcd': 'PCDLoader',\r\n\t'prwm': 'PRWMLoader',\r\n\t'stl': 'STLLoader',\r\n\t'tds': 'TDSLoader',\r\n\t'vtk': 'VTKLoader',\r\n\t'vtp': 'VTKLoader',\r\n\t'wrl': 'VRMLLoader',\r\n\t'x': 'XLoader',\r\n\t'zae': 'ColladaArchiveLoader',\r\n\r\n};\r\n\r\nfunction extractExtension( url ) {\r\n\r\n\tvar extMatches = url.match( /\\.([^\\.\\/\\\\]+)$/ );\r\n\tvar urlExt = extMatches ? extMatches[ 1 ] : null;\r\n\treturn urlExt;\r\n\r\n}\r\n\r\nexport default\r\nclass ModelLoader {\r\n\r\n\tstatic get ExtensionToThreeLoader() {\r\n\r\n\t\treturn loaderMap;\r\n\r\n\t}\r\n\r\n\tconstructor( manager ) {\r\n\r\n\t\tthis.manager = ( manager !== undefined ) ? manager : DefaultLoadingManager;\r\n\t\tthis.loaderCallbacks = {};\r\n\r\n\t}\r\n\r\n\t/* Override-able Interface */\r\n\t// function that creates a loader instance and passes it back to\r\n\t// the `loaderCb`.\r\n\tgetLoadCallback( ext, done ) {\r\n\r\n\t\tdone( this.loaderCallbacks[ ext ] || null );\r\n\r\n\t}\r\n\r\n\tcanLoadModel( urlOrExt ) {\r\n\r\n\t\treturn urlOrExt in this.loaderCallbacks || extractExtension( urlOrExt ) in this.loaderCallbacks;\r\n\r\n\t}\r\n\r\n\t/* Public Functions */\r\n\tload( url, onLoad, onProgress, onError, options = {} ) {\r\n\r\n\t\tonError = onError || ( e => console.error( e ) );\r\n\r\n\t\t// Get the extension associated the file so we can get the\r\n\t\t// appropriate loader\r\n\t\tvar urlExt = extractExtension( url );\r\n\t\tvar ext = options.extension || urlExt;\r\n\r\n\t\tif ( ext == null ) {\r\n\r\n\t\t\tonError( new Error( 'ModelLoader : No file extension found' ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.getLoadCallback( ext, func => {\r\n\r\n\t\t\t\tif ( func ) {\r\n\r\n\t\t\t\t\tfunc.call(this, url, this.manager, res => {\r\n\r\n\t\t\t\t\t\tonLoad( this.formResult( res ) );\r\n\r\n\t\t\t\t\t}, onProgress, onError, options );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tonError( new Error( `ModelLoader: No load callback provided for extension '${ ext }'.` ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tparse( data, extension, onLoad, onError, options = {} ) {\r\n\r\n\t\toptions = Object.assign( {\r\n\r\n\t\t\textension\r\n\r\n\t\t}, options );\r\n\r\n\t\tconst blob = new Blob( [ data ] );\r\n\t\tconst url = URL.createObjectURL( blob );\r\n\t\tthis.load( url, function( ...args ) {\r\n\r\n\t\t\tURL.revokeObjectURL( url );\r\n\t\t\tonLoad( ...args );\r\n\r\n\t\t}, undefined, onError, options );\r\n\r\n\t}\r\n\r\n\t/* Private Functions */\r\n\t// Forms the resultant object from a load to normalize the return format.\r\n\tformResult( res, extension ) {\r\n\r\n\t\tlet model = res.scene || res.object || res;\r\n\t\tif ( model.isBufferGeometry || model.isGeometry ) {\r\n\r\n\t\t\tconst material = new MeshPhongMaterial( { color: 0xffffff } );\r\n\t\t\tmodel = new Mesh( model, material );\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\r\n\t\t\tmodel,\r\n\t\t\textension,\r\n\t\t\toriginalResult: res\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n};\r\n"],"names":["DefaultLoadingManager","MeshPhongMaterial","Mesh"],"mappings":"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"}